name: Notify Result by Discord
description: workflow ìˆ˜í–‰ ê²°ê³¼ë¥¼ Discord ì±„ë„ì— ì „ì†¡

inputs:
  failed_jobs:
    required: true
    description: ì‹¤íŒ¨í•œ job ë‚´ì—­.(ex. job1,job2)
  title:
    required: true
    description: ì™„ë£Œ/ì‹¤íŒ¨ì— ëŒ€í•œ ì œëª©
  discord_webhook_url:
    required: true
    description: Discord ì›¹í›… url
  version:
    required: false
    description: ë°°í¬í•œ ë²„ì „

runs:
  using: "composite"
  steps:
    - name: Create Fail Message
      id: create-message
      if: inputs.failed_jobs != ''
      run: |
        github_url="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"

        jobs="${{ inputs.failed_jobs }}"
        formatted_jobs=""
        IFS=',' read -ra JOB_ARRAY <<< "$jobs"
        for job in "${JOB_ARRAY[@]}"; do
          formatted_jobs+="  - $job\n"
        done

        message="**[ğŸ˜¢ ë°°í¬ ì‹¤íŒ¨]**\n"
        message+="- ì„œë¹„ìŠ¤: `${{ inputs.title }}`\n"
        message+="- ì‹¤íŒ¨í•œ job:\n$formatted_jobs"
        message+="ğŸ‘‰[workflow í™•ì¸]($github_url)"

        echo "message=$message" >> $GITHUB_OUTPUT
      shell: bash

    - name: Create Success Message
      id: create-message
      if: inputs.failed_jobs == ''
      run: |
        message="**[ğŸ£ ë°°í¬ ì„±ê³µ]**\n"
        message+="- ì„œë¹„ìŠ¤: `${{ inputs.title }}`\n"
        message+="- ë²„ì „: `${{ inputs.version }}`"

        echo "message=$message" >> $GITHUB_OUTPUT
      shell: bash

    - name: Send Message
      run: |
        message="${{ steps.create-message.outputs.message }}"
        curl -H "Content-Type: application/json" \
             -X POST \
             -d "{\"content\": \"$message\"}" \
             "${{ inputs.discord_webhook_url }}"
      shell: bash
      